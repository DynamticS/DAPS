# language setting
language: python
notifications:
   email: false
archive: true

python:
  - "3.4"

before_script:
  - cd /root/workspace/src/github.com/greenelab/DAPS

script:
  - nose2 --plugin nose2.plugins.junitxml --junit-xml test 
  - mv nose2-junit.xml shippable/testresults/tests.xml
  - curl https://zenodo.org/record/46607/files/data.zip -o data.zip
  - unzip data.zip -d
  - jupyter nbconvert --to html --execute ./Figures.ipynb
  - cp Figures.html shippable/buildoutput/
  - coverage run --branch test.py
  - coverage xml -o shippable/codecoverage/coverage.xml test.py

after_success:
  - git config user.email "brettbj@gmail.com"
  - git config user.name "Brett Beaulieu-Jones"
  - git config --global push.default simple
  - git remote set-url origin git@github.com:greenelab/DAPS.git

  - git commit shippable/* -m "[skip ci] Successful build from $COMMIT"
  - git stash
  - git checkout master
  - git merge --no-ff staging -Xtheirs
  - ssh-agent bash -c "ssh-add ~/keys/id_${JOB_ID}; git push"